import boto3

def analyze_iam_policy(role_name):
    iam = boto3.client('iam')

    # Get the role's policy
    role_policy = iam.get_role_policy(
        RoleName=role_name,
        PolicyName='AmazonS3FullAccess'  # Change this to your policy name
    )

    # Extract the policy document
    policy_document = role_policy['PolicyDocument']

    # Extract some basic information
    version = policy_document.get('Version', 'N/A')
    statement_count = len(policy_document.get('Statement', []))

    print("IAM Policy Analysis:")
    print(f"Version: {version}")
    print(f"Number of Statements: {statement_count}")

    # Analyze each statement in the policy
    for idx, statement in enumerate(policy_document.get('Statement', []), start=1):
        print(f"\nStatement {idx}:")
        effect = statement.get('Effect', 'N/A')
        actions = statement.get('Action', 'N/A')
        resources = statement.get('Resource', 'N/A')
        conditions = statement.get('Condition', 'N/A')

        print(f"Effect: {effect}")
        print(f"Actions: {actions}")
        print(f"Resources: {resources}")
        print(f"Conditions: {conditions}")

# Example IAM role name
role_name = 'your-role-name'  # Replace 'your-role-name' with your actual IAM role name

# Analyze the IAM role policy
analyze_iam_policy(role_name)


import boto3
import json

def is_permission_in_policy(role_name, permission):
    # Create IAM client
    iam_client = boto3.client('iam')

    # Get the policy
    response = iam_client.get_role_policy(
        RoleName=role_name,
        PolicyName='your-policy-name'  # Replace 'your-policy-name' with the actual policy name
    )

    # Extract policy document
    policy_document = json.loads(response['PolicyDocument'])

    # Check if permission is in policy
    for statement in policy_document['Statement']:
        if 'Action' in statement and permission in statement['Action']:
            return True

    return False

# Example usage:
role_name = 'your-role-name'
permission = 's3:GetObject'  # Replace with the permission you want to check
is_permission_present = is_permission_in_policy(role_name, permission)
if is_permission_present:
    print(f"Permission '{permission}' is present in the policy for role '{role_name}'.")
else:
    print(f"Permission '{permission}' is not present in the policy for role '{role_name}'.")
import boto3

def get_attached_policy_documents(account_id):
    iam_client = boto3.client('iam')
    
    # Get a list of IAM roles in the account
    roles = iam_client.list_roles()['Roles']
    
    for role in roles:
        role_name = role['RoleName']
        role_arn = role['Arn']
        
        # Get a list of attached policies for the current role
        attached_policies = iam_client.list_attached_role_policies(RoleName=role_name)['AttachedPolicies']
        
        print(f"Role: {role_name} ({role_arn})")
        if attached_policies:
            for policy in attached_policies:
                policy_name = policy['PolicyName']
                policy_arn = policy['PolicyArn']
                
                # Get the policy document for the attached policy
                policy_document = iam_client.get_policy(PolicyArn=policy_arn)['Policy']['DefaultVersionId']
                
                print(f"\tAttached Policy: {policy_name} ({policy_arn})")
                print(f"\tPolicy Document:\n{policy_document}\n")
        else:
            print("\tNo attached policies\n")

# Replace '123456789012' with your AWS account ID
account_id = '123456789012'
get_attached_policy_documents(account_id)

import boto3

def get_attached_policy_documents(account_id):
    iam_client = boto3.client('iam')
    
    # Get a list of IAM roles in the account
    roles = iam_client.list_roles()['Roles']
    
    for role in roles:
        role_name = role['RoleName']
        role_arn = role['Arn']
        
        # Get a list of attached policies for the current role
        attached_policies = iam_client.list_attached_role_policies(RoleName=role_name)['AttachedPolicies']
        
        print(f"Role: {role_name} ({role_arn})")
        if attached_policies:
            for policy in attached_policies:
                policy_name = policy['PolicyName']
                policy_arn = policy['PolicyArn']
                
                # Get the policy document for the attached policy
                policy_document = iam_client.get_policy(PolicyArn=policy_arn)['Policy']['DefaultVersionId']
                
                print(f"\tAttached Policy: {policy_name} ({policy_arn})")
                print(f"\tPolicy Document:\n{policy_document}\n")
        else:
            print("\tNo attached policies\n")

# Replace '123456789012' with your AWS account ID
account_id = '123456789012'
get_attached_policy_documents(account_id)



import boto3
import json

def analyze_role_policy(role_name, permissions_to_check):
    iam_client = boto3.client('iam')
    
    try:
        role = iam_client.get_role(RoleName=role_name)
        role_policy = iam_client.get_role_policy(RoleName=role_name, PolicyName=role['Role']['AssumeRolePolicyDocument'])
        policy_document = json.loads(role_policy['PolicyDocument'])
        permissions = set()

        if 'Statement' in policy_document:
            for statement in policy_document['Statement']:
                if 'Action' in statement:
                    actions = statement['Action']
                    if isinstance(actions, str):
                        permissions.add(actions)
                    elif isinstance(actions, list):
                        permissions.update(actions)

        print("Permissions found in the role's policy document:")
        for permission in permissions_to_check:
            if permission in permissions:
                print(f"{permission}: Found")
            else:
                print(f"{permission}: Not found")

    except iam_client.exceptions.NoSuchEntityException:
        print(f"Role '{role_name}' not found.")

def main():
    role_name = 'your_role_name'
    permissions_to_check = ['s3:GetObject', 'ec2:DescribeInstances', 'iam:ListRoles']  # Add permissions to check here

    analyze_role_policy(role_name, permissions_to_check)

if __name__ == "__main__":
    main()
